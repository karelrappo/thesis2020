---
title: "Appendices"
date: "12.11-2020"
output: 
  bookdown::pdf_document2:
    toc: no
csl: apa.csl
bibliography: library.bib
indent: yes
fontsize: 12pt
geometry: margin = 1in
link-citations: yes
linkcolor: blue
urlcolor: blue
header-includes:
- \usepackage{placeins}
- \usepackage{setspace}
- \usepackage{chngcntr}
- \usepackage{microtype}
- \counterwithin{figure}{section}
- \counterwithin{table}{section}
- \usepackage{float}
- \usepackage{amsmath}
- \DeclareMathOperator{\logit}{logit}
---

# Appendices
```{r run libraries, include=F}
library(stringr)
library(tidyverse)
library(summarytools)
library(kableExtra)
library(dynlm)
library(stats)
library(readr)
library(dplyr)
library(ggplot2)
library(data.table)
library(MacroRF)
require(data.table)
library(zoo)
library(sandwich)
library(modelr)
library(Metrics)
```

```{r child = 'Dataclean.rmd'}
```


```{r create_log, include=F}
df <- df %>%
  mutate(log_gdp=log(1+GDP/100)*100)

df <- df %>%
  arrange %>%
    mutate(H12=rollapply(log_gdp,5,FUN = function(df) mean(df[-5], na.rm = TRUE), fill = NA, align = "left" )) %>%
    mutate(H18=rollapply(log_gdp, 7,FUN = function(df) mean(df[-7], na.rm = TRUE), fill = NA, align = "left" )) %>%
    mutate(H24=rollapply(log_gdp, 9,FUN = function(df) mean(df[-9], na.rm = TRUE), fill = NA, align = "left" )) %>%
    mutate(H30=rollapply(log_gdp, 11,FUN = function(df) mean(df[-11], na.rm = TRUE), fill = NA, align = "left" )) %>%
    mutate(H36=rollapply(log_gdp, 13,FUN = function(df) mean(df[-13], na.rm = TRUE), fill = NA, align = "left" ))

dummy <- read.csv("Dummy.csv")

df <- df %>%
  mutate(dum = dummy$Reccession)

df.expansionary <- subset(df, dum== 0)
df.recessionary <- subset(df, dum== 1)

```




```{r reg_output, include=F}
# Out-of-sample regression
do_regression <- function(var)
{ # var - the name of the variable to be regressed
  res <- dynlm(as.formula(paste0(var, "~ YIV")), df[1:45,]) # run linear regression
  predicted <- predict(res, df[46:91,], type = "response")
  actual <- df[[var]][46:91]
  RMSFE <-rmse(actual,predicted)
return(RMSFE)
}
# In-sample regression
do_regression2 <- function(var)
{ # var - the name of the variable to be regressed
  res <- dynlm(as.formula(paste0(var, "~ YIV")), df[1:91,]) # run linear regression
  predicted <- predict(res, df[46:91,], type = "response")
  actual <- df[[var]][46:91]
  RMSFE <-rmse(actual,predicted)
return(RMSFE)
}

# Out-of-sample expansionary regression
do_regression3 <- function(var)
{ # var - the name of the variable to be regressed
  res <- dynlm(as.formula(paste0(var, "~ YIV")), df.expansionary[1:39,]) # run linear regression
  predicted <- predict(res, df[40:79,], type = "response")
  actual <- df[[var]][40:79]
  RMSFE <-rmse(actual,predicted)
return(RMSFE)
}


# Out-of-sample recessionary regression
do_regression4 <- function(var)
{ # var - the name of the variable to be regressed
  res <- dynlm(as.formula(paste0(var, "~ YIV")), df.expansionary[1:6,]) # run linear regression
  predicted <- predict(res, df[6:12,], type = "response")
  actual <- df[[var]][6:12]
  RMSFE <-rmse(actual,predicted)
return(RMSFE)
}

# In-sample expansionary regression
do_regression5 <- function(var)
{ # var - the name of the variable to be regressed
  res <- dynlm(as.formula(paste0(var, "~ YIV")), df.expansionary[1:79,]) # run linear regression
  predicted <- predict(res, df[40:79,], type = "response")
  actual <- df[[var]][40:79]
  RMSFE <-rmse(actual,predicted)
return(RMSFE)
}

# In-sample recessionary regression
do_regression6 <- function(var)
{ # var - the name of the variable to be regressed
  res <- dynlm(as.formula(paste0(var, "~ YIV")), df.expansionary[1:12,]) # run linear regression
  predicted <- predict(res, df[6:12,], type = "response")
  actual <- df[[var]][6:12]
  RMSFE <-rmse(actual,predicted)
return(RMSFE)
}





df_results1 <- as.data.frame(t(sapply(colnames(df)[6:10], do_regression)))
df_results2 <- as.data.frame(t(sapply(colnames(df)[6:10], do_regression2)))
df_results3 <- as.data.frame(t(sapply(colnames(df)[6:10], do_regression3)))
df_results4 <- as.data.frame(t(sapply(colnames(df)[6:10], do_regression4)))
df_results5 <- as.data.frame(t(sapply(colnames(df)[6:10], do_regression5)))
df_results6 <- as.data.frame(t(sapply(colnames(df)[6:10], do_regression6)))

df_results <- rbind(df_results1, df_results2, df_results3, df_results4, df_results5, df_results6)

df_results <- df_results %>%
  round(2)

colnames(df_results, do.NULL = FALSE)
colnames(df_results) <- c("H12","H18","H24","H30","H36")
rownames(df_results) <- c("Out-of-sample RMSFE", "In-sample RMSFE", "Out-of-sample expansionary RMSFE", "Out-of-sample recessionary RMSFE", "In-sample expansionary RMSFE", "In-sample recessionary RMSFE")

```


## Out-of-sample test. 

```{r tableOLS, message = F, warnings = F,echo = F}
df_results %>%
  kbl() %>%
  kable_styling()
```




