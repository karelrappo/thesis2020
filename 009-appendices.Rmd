---
title: "Appendices"
date: "12.11-2020"
output: 
  bookdown::pdf_document2:
    toc: no
csl: apa.csl
bibliography: library.bib
indent: yes
fontsize: 12pt
geometry: margin = 1in
link-citations: yes
linkcolor: blue
urlcolor: blue
header-includes:
- \usepackage{placeins}
- \usepackage{setspace}
- \usepackage{chngcntr}
- \usepackage{microtype}
- \counterwithin{figure}{section}
- \counterwithin{table}{section}
- \usepackage{float}
- \usepackage{amsmath}
- \DeclareMathOperator{\logit}{logit}
---

```{r, include=F}
source("functions.R")
```


# Appendices

## Appendix A

As researchers typically do not typically post underlying data with their research, various plot digitizers have seen an exponential increase in use. @Drevon2017 researched intercoder reliability, during which over 3500 data points were extracted with WebPlotDigitizer from 36 different graphs. Nevertheless, they controlled the validity of the results and concluded that there was a near perfect correlation (r=0.989 with p-value <0.01) between extracted and actual data. Nevertheless, the limitations mentioned highlight coders previous experience with plot-digitizing tools.

Furthermore, @Burda2017 also highlight that systematic reviewers often tend to have data constraints which is why plot digitizers are of a great help. They estimated data using WebPlotDigitizer and conclude that the extraction done by different coders was consistent; nevertheless, in the case of continuous data (compared to event data), the distribution varied more. Whatsoever, the intreclass coefficient for both types of plots was over 95%.

We also used the WebPlotDigitzer in our research and as validity test extracted GDP from the same graph as YIV time series & plotted it with actuals - see the graph below.



```{r vsextracted, message=F, warnings=F,echo = F, fig.height=5, fig.cap="Actual vs Extracted GDP growth rate in %"}
GDP_data <- read_csv("data/actualvsplot.csv")

extracted <- ggplot(GDP_data,aes(x=Date)) + geom_line(aes(y=Actual, color="Actual"), color="red") + geom_line(aes(y=Extracted, color="Extracted"), color="blue") +theme_bw() + ylab("GDP growth %") + theme_bw()

extracted

```


\newpage
## Appendix B
```{r regfit, message = F, warnings = F, echo = F, fig.height=2.5, fig.width=6, fig.cap="Regressions' R-squared"}
regr1 <- regrs(mudelid=c("YIV"))
results1 <- regr_results(a=regr1)
results1 <- as.data.frame(t(results1))

regression.fit <- ggplot(results1, aes(x=row.names(results1),y=r.squared)) + geom_bar(stat="identity", fill="steelblue")+ theme_minimal() + xlab("Quarters") + ylab("R-squared") + labs(title = "GDP R-squared") +  theme(plot.title = element_text(hjust = 0.5)) + scale_x_discrete(limits=c("H4", "H6", "H8", "H10", "H12"))

regression.fit
```



```{r regcoefficients, message = F, warnings = F, echo = F, fig.height=3, fig.width=6, fig.cap="Regressions' coefficients"}

regression.coefficients <- ggplot(results1, aes(x=row.names(results1), y=YIV_estimate))+ geom_bar(stat="identity", fill="steelblue")+theme_minimal()+ xlab("Quarters") + ylab("Coefficients") + labs(title = "GDP coefficients") + theme(plot.title = element_text(hjust = 0.5)) + scale_x_discrete(limits=c("H4", "H6", "H8", "H10", "H12"))

regression.coefficients

```



\newpage
## Appendix D

Notes: This table includes regression with controls. The equation for the regression is following:

\begin{equation}
\sum_{j=1}^{j=H}log(1+GDP_{i,t+j})/H = \alpha_{H}+ \beta_{H} \sigma_{IV,t}^{INT} +\varepsilon_{t+H}
\end{equation}



```{r OLS4, message = F, warnings = F,echo = F}
regr4 <- regrs(mudelid=c("DGS1","TRM1012", "SRT03M", "baa_aaa", "VIX", "housng", "gz_spr", "spy_logreturn"))
results4 <- regr_results(a=regr4)

results4  %>%
  kbl(booktabs = T,longtable=T, align="c", digits=2, caption="Regression with state-dependency") %>%
   kable_styling(latex_options = c("striped"), full_width = TRUE) %>%
   column_spec(1:1, width="2in")%>%
       footnote(general = "*** - p<0.01, ** - p<0.05, * - p<0.1. Reported standard error is adjusted for heteroskedasticity")

#model4 <- lm(log_gdp ~ lag1 + lag2 + DGS1 + TRM1012 + SRT03M + baa_aaa + VIX + housng + gz_spr + spy_logreturn, df)
#ols_vif_tol(model4)
```

\newpage
## Appendix E

Notes: YIV, dummy and controls as independent variables. The equation for the regression is following:

\begin{equation}
\sum_{j=1}^{j=H}log(1+GDP_{i,t+j})/H = \alpha_{H}+ \beta_{H} \sigma_{IV,t}^{INT} +\varepsilon_{t+H}
\end{equation}



```{r OLS5, message = F, warnings = F,echo = F}
regr5 <- regrs(mudelid=c("YIV", "dum", "DGS1", "TRM1012", "SRT03M", "baa_aaa", "VIX", "housng", "gz_spr", "spy_logreturn"))
results5 <- regr_results(a=regr5)

results5  %>%
  kbl(booktabs = T,longtable=T, align="c", digits=2, caption="Regression with state-dependency") %>%
   kable_styling(latex_options = c("striped"), full_width = TRUE) %>%
    column_spec(1:1, width="2in")%>%
       footnote(general = "*** - p<0.01, ** - p<0.05, * - p<0.1. Reported standard error is adjusted for heteroskedasticity")

#model5 <- lm(log_gdp ~ YIV + dum + YIV*dum + lag2 + DGS1 + TRM1012 + SRT03M + baa_aaa + VIX + housng + gz_spr + spy_logreturn, df)
#ols_vif_tol(model5)

# model6 <- lm(log_gdp ~  YIV + dum + YIV*dum + lag1 + lag2 + DGS1 + TRM1012 + SRT03M + baa_aaa + VIX + housng + gz_spr + spy_logreturn, df)
# ols_step_forward_p(model6)
# ols_step_best_subset(model6)
# ols_step_all_possible(model6)

```
\newpage

## Appendix F


```{r roll_regress, message = F, warnings = F,echo = F, }

df_resultss %>%
  kbl(longtable=T, booktabs=T) %>%
  kable_styling() 
```


```{r oosgraph, message = F, warnings = F,echo = F, fig.cap="Out-of-sample RMSFE for various estimations"}
df_results <- transpose(df_resultss)
df_resultss2 <- melt(df_resultss)
df_resultss2$rowid <- c("YIV", "YIV_Recessionary", "YIV_Expansionary" ,"Naive", "Naive_Recessionary", "Naive_Expansionary", "TRM", "CRS")

ggplot(df_resultss2, aes(variable, value, group=factor(rowid))) + geom_line(aes(color=factor(rowid))) + theme_bw() + theme(legend.position = "none") + labs(x="Time horizon", y="RMSFE value", color="Model", caption="Naive refers to regressions with GDP and its lags, TRM - term spreads, CRS - credit spreads") + facet_wrap( ~rowid)


```
\newpage

## Appendix G

```{r message = F, warnings = F,echo = F, fig.cap="Predicted vs actual results (Linear model)"}

pred_vs_actual_graph(lm)

```

```{r message = F, warnings = F,echo = F, fig.cap="Predicted vs actual results (Random forest)"}

pred_vs_actual_graph(rf)

```

\newpage
## Appendix H^[Full R-Code with data is available upon request in github repository: https://github.com/karelrappo/thesis2020]


```{r message = F, warnings = F,echo = F, fig.cap="RMSFE-s of linear model and random forest"}

ggplot(rf_resultsss, aes(variable, value, group=factor(period))) + geom_line(aes(color=factor(period))) + theme(legend.position="bottom") + labs(x="Time horizon", y="GDP growth value", color="Model") + 
  facet_wrap(~type) + scale_color_manual(values=c("blue", "red"))

```


\newpage
## Appendix H

```{r,message = F, warnings = F,echo = F}
summary_table <- colnames(df_summary)
summary_table <- summary_table %>%
  as_tibble() %>%
  rename(Variable=value)
summary_table$Description <- c("5 - year Treasury Implied Volatility",
                               "Year-on-year change in real gross domestic product",
                               "logarithmic yearly returns of SPY index",
                               "Returns of VIX index",
                               "BAA corporate bond yields",
                               "AAA corporate bond yields",
                               "Yield spread between BAA and AAA yields",
                               "Credit risk spread index",
                               "New housing market starts",
                               "Changes in 3 month treasury yield",
                               "TRM1003 - 10 year and 3 month treasury yield spread",
                               "TRM1006 - 10 year and 6 month treasury yield spread",
                               "TRM1012 - 10 year and 1 year treasury yield spread",
                               "TRM0503 - 5 year and 3 month treasury yield spread",
                               "TRM0506 - 5 year and 6 month treasury yield spread")
summary_table %>%
  kbl(longtable=T, booktabs=T) %>%
  kable_styling() 
```

\newpage
## Appendix I

```{r message = F, warnings = F,echo = F, fig.cap="Cumulative sum of squared forecast error differential (Linear model vs benchmark historic mean model"}
CSSFED_plot("hist_lm")
```
```{r message = F, warnings = F,echo = F, fig.cap="Cumulative sum of squared forecast error differential (Random forest model vs benchmark historic mean model"}
CSSFED_plot("hist_rf")
```

```{r message = F, warnings = F,echo = F, fig.cap="Cumulative sum of squared forecast error differential (Random forest model vs benchmark linear model"}
CSSFED_plot("lm_rf")
```

```{r message = F, warnings = F,echo = F, fig.cap="Squared errors"}
squared_error_plot(c("OOS_error_hist", "OOS_error_lm", "OOS_error_rf"))
```
