---
title: "TIV"
output: 
  bookdown::pdf_document2:
    toc: no
indent: yes
fontsize: 12pt
geometry: margin = 1in
link-citations: yes
linkcolor: blue
urlcolor: blue
header-includes:
- \usepackage{placeins}
- \usepackage{setspace}
- \usepackage{chngcntr}
- \usepackage{microtype}
- \counterwithin{figure}{section}
- \counterwithin{table}{section}
- \usepackage{float}
- \usepackage{amsmath}
- \DeclareMathOperator{\logit}{logit}
---

# Appendices
```{r run libraries, include=F}
library(stringr)
library(tidyverse)
library(summarytools)
library(kableExtra)
library(dynlm)
library(stats)
library(readr)
library(dplyr)
library(ggplot2)
library(data.table)
library(MacroRF)
require(data.table)
library(zoo)
```


```{r create_log, include=F}
df2 <- read.csv("tiv_gdp.csv")
df2$Date <- as.Date(df2$Date, origin = "1899-12-30")

df2$log_gdp = log(1+df2$GDP/100)*100

df2 <- df2 %>%
  arrange %>%
    mutate(H12=rollapply(log_gdp, 5, FUN = function(df2) mean(df2[-5], na.rm = TRUE), fill = NA, align = "right" )) %>%
      mutate(H18=rollapply(log_gdp, 7,FUN = function(df2) mean(df2[-7], na.rm = TRUE), fill = NA, align = "right" )) %>%
        mutate(H24=rollapply(log_gdp, 9,FUN = function(df2) mean(df2[-9], na.rm = TRUE), fill = NA, align = "right" )) %>%
          mutate(H30=rollapply(log_gdp, 11,FUN = function(df2) mean(df2[-11], na.rm = TRUE), fill = NA, align = "right" ))
```


```{r reg_output, include=F}
# define a function to get coefficients from linear regression
  
do_regression <- function(var)
  { # var - the name of the variable to be regressed
    res <- dynlm(as.formula(paste0(var, "~ TIV")), df2) # run linear regression
    coefs <- c("R-Squared"= summary(res)$r.squared, "Intercept" = summary(res)$coefficients[1], "Beta" = summary(res)$coefficients[2], "t-statistic" = summary(res)$coefficients[,3]) 
  return(coefs)
  }

df_results <- as.data.frame(t(sapply(colnames(df2)[5:8], do_regression)))
#sapply : applies on "var3"(first YIV) ..."var23"(last)  the function do_lm
#t() transposes

df_results <- df_results %>%
  round(2)
```




## Appendix B. 

```{r tableOLS, message = F, warnings = F,echo = F}
kbl(cbind(t(df_results)), booktabs = T, longtable=T, align="c", digits=2, caption="Regression output") %>%
   kable_styling(latex_options = c("striped"), full_width = TRUE) %>%
     pack_rows("Panel A: TIV",1,3, latex_align="c") %>%
       footnote(general = "Preliminary regression output. Initial data needs to be re-checked.")

```
