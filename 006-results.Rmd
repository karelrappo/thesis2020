---
title: "Results"
author: "Karel Räpp, Henry Enno Turu"
date: "29 11 2020"
output: 
  bookdown::pdf_document2:
    toc: no
csl: apa.csl
bibliography: library.bib
indent: yes
fontsize: 12pt
geometry: margin = 1in
link-citations: yes
linkcolor: blue
urlcolor: blue
header-includes:
- \usepackage{placeins}
- \usepackage{setspace}
- \usepackage{chngcntr}
- \usepackage{microtype}
- \counterwithin{figure}{section}
- \counterwithin{table}{section}
- \usepackage{float}
- \usepackage{amsmath}
- \DeclareMathOperator{\logit}{logit}
---

```{r resultimport, include=F, message = F, warnings = F,echo = F}
source("functions.R")
```


# Results

Before diving to details, we plot quarterly YIV with quarterly GDP to see whether visual patterns arise. As it can be seen, the YIV seems to have a negative correlation with GDP. This relationship is especially profound  during Global Financial Crisis (around 2008-2009) when YIV surges up a bit before where a big decline in GDP happens. This is confirms our base for analysis as suggested by the literature review that indeed the treasury could have predictive ability over GDP.

```{r, YIV-gdp, message=F, warnings=F, echo = F, fig.cap="GDP Growth(%) vs 5-year Treasury Implied Volatility"}
df %>%
  select(Date, GDP, YIV) %>%
  gather(key = "variable", value = "value", -Date) %>%
  ggplot(aes(x=Date, y=value)) +
    geom_line(aes(color = variable, linetype = variable)) +
    theme_bw() +
    theme(legend.position = "bottom", legend.title = element_blank()) +
    labs(x="Date", y="Growth rate")
```

## In-sample regressions

We start our analysis by regressing YIV to GDP growth throughout different rolling periods - i.e. from H=1 to H=12 quarterly GDP growth rolling averages (the regression formula and summary can be seen in \@ref(tab:OLS1)). In order to correctly interpret the regression results, the coefficient must be multiplied by the standard deviation and the result obtained is the impact on yearly GDP growth. Hence, as an example of H=1, the results implicate that 1 standard deviation increase in YIV is associated with a -1.03/4 * 1.31% = 0.34% decrease in gdp growth within the next 1 quarter. For predicting 8 quarters ahead (2 years), 1 standard deviation increase in YIV is associated with a -0.6 * 2 * 1.31% = 1.57% decrease in GDP growth. To illustrate the magnitude of this reduction, one should note that the average year-on-year growth rate in our sample is 2,5%.

Furthermore, it can be seen, YIV’s coefficients are significant throughout the prediction periods within 1% confidence level. The model’s R-squared varies within the reported range  from 36% for predicting 2 quarters ahead down to 19% for predicting 2 years ahead. Lastly, as an additional robustness check to ensure that YIV predicts GDP growth and not the other way around, we run the Granger causality test by which we indeed conclude that YIV granger-caused GDP growth.


\begingroup
\linespread{1.0}\selectfont

\begin{equation}
\sum_{j=1}^{j=H}log(1+GDP_{i,t+j})/H = \alpha_{H}+ \beta_{H} \sigma_{IV,t} +\varepsilon_{t+H}
\end{equation}


```{r OLS1, message = F, warnings = F,echo = F}
regr1 <- regrs(mudelid=c("YIV"),interaction=F)
results1 <- regr_results(a=regr1) %>%
    round(2) %>%
    significance() %>%
    rename(" "=rowname)

results1 %>%
  kbl(booktabs = T, longtable=T, align="c", digits=2, caption="Regression output") %>%
  kable_styling(latex_options = c("striped"), full_width = TRUE) %>%
     column_spec(1:1, width="2in")%>%
  footnote(general = "*** - p<0.01, ** - p<0.05, * - p<0.1. Reported standard error is adjusted for heteroskedasticity")

#grangertest(log_gdp ~ YIV, order=1, df)
```
\endgroup

Next, we add a dummy variable representing recessionary periods (according to the NBER classification) i.e. the dummy takes a value of 1 during recession and 0 during expansion table \@ref(tab:OLS2)). As it can be seen from the table, the dummy’s coefficient is negative and significant at 1% confidence level throughout all predicted time spans - nevertheless, the interaction term between YIV and dummy variable is insignificant throughout all forecast horizons. Hence, this means that recessionary period only influences the intercept, not slope of the variable. However, adding the dummy improved R-squared significantly - 54% in predicting ahead GDP growth 4 quarters’ rolling averages when compared to 33% of respective YIV-only model. The latter indicates that there is a structural break in data during recessions and that full model predictions during recessionary periods could result in worse prediction accuracy.

\begingroup
\linespread{1.0}\selectfont

\begin{equation}
\sum_{j=1}^{j=H}log(1+GDP_{i,t+j})/H = \alpha_{H}+ \beta_{H} \sigma_{IV,t} + Dummy +\varepsilon_{t+H}
\end{equation}


```{r OLS2, message = F, warnings = F,echo = F}
regr2 <- regrs(mudelid=c("YIV", "dum"),interaction=T)
results2 <- regr_results(a=regr2) %>%
    round(2) %>%
    significance() %>%
    rename(" "=rowname)


results2  %>%
  kbl(booktabs = T,longtable=T, align="c", digits=2, caption="Regression with state-dependency") %>%
   kable_styling(latex_options = c("striped"), full_width = TRUE) %>%
     column_spec(1:1, width="2in")%>%
       footnote(general = "*** - p<0.01, ** - p<0.05, * - p<0.1. Reported standard error is adjusted for heteroskedasticity")

#model2 <- lm(log_gdp ~ YIV + dum + YIV*dum, df)
#ols_vif_tol(model2)
```
\endgroup

Additionally, we also constructed a model with controls as regressors (Table \@ref(tab:OLS4)). The controls variables were selected among the variables described in the data section. More specifically, the following controls were selected initially: DGS1, DGS5, DGS10, DGS3MO, DGS6MO, TRM0503, TRM0506, TRM1003, TRM1006, TRM1012, STR03M, BAA-AAA, VIX, HOUSNG, GZ_SPR, SPY However, due to multicollinearity problems among DSG and TRM controls we constructed a model for variable selection and  selected the best predictor among those groups. For selection criteria, both R-squared and Mallow’s Cp were used and according to this we chose DGS10 and TRM1012 as the best predictors out of DGS and TRM control groups. Thus, in the final regression model the following controls were included: DGS1, TRM1012, STR03M, BAA-AAA, VIX, HOUSNG, GZ_SPR, SPY.

Finally, we included all the aforementioned independent variables to one regression equation (Table \@ref(tab:OLS5)). As it can be seen, even when including all the relevant control variables, the YIV still remains a significant predictor throughout all the periods. In the final model, the regression results implicate that 1 standard deviation increase in YIV is associated with a -0.75 * 1.31% = -0.98 % decrease in gdp growth within the next 4 quarters (5% confidence level). Additionally, when predicting 8 quarters ahead a 1 standard deviation increase in YIV is associated with a -0.54* 1.31% * 2 = 1.42% decrease in the next 8 quarters’ average annualized growth rate within a 5% confidence level.


## Out of sample forecasting
### Full sample

We were not only interested in the in-sample performance of the variable. Hence, we constructed out-of-sample regressions to compute RMSFE-s of full-sample and subsample models. For the out-of-sample regressions we used 5 year rolling windows and predicted ahead 1 to 8 quarters. Nevertheless, it is important to note that as mentioned in the former sections, we use h-step forward-looking quarterly growth(denoted as F1,F2,etc.), instead of the year-on-year averaged growth rates (denoted H1,H2 etc.). Looking at the full model’s predicted vs actual observations (see \@ref(fig:pred-vs-actual-lm), it can be seen that the predicted values tend to differ more as the forecast horizon increases. While forecasting 1-period ahead the predicted graph is fairly similar to the actual observations, then for F4 two big forecast errors can be noticed.

This is consistent with the RMSFEs calculated (see \@ref(fig:oosgraph)). It is that the RMSFE’s tend to increase with the forecast horizon, except for F2. In other words, the interpretation of it was that the model's accuracy in predicting GDP growth got worse in predicting further time periods. Comparing the full-model with only YIV or only individual control variable models, it is interesting that it yields the highest forecast error. This is caused by the fact that the full model in addition to the other control variables include dummy variable, housing market, VIX, 1 month treasury yield and changes in short rate.

### Sub-sample OOS forecasting

Next, we wanted to compare the full-sample OOS RMSFE-s with the subsample OOS RMSFE-s. As it can be seen, during the recessionary period the RMSFE is significantly higher when compared to the full-sample RMSFE - furthermore, this holds for all the different models. In the case of YIV model and the recessionary subsample, the RMSFE drops sharply at F8. The explanation for this is rather logical: as the the F8 includes the upcoming 8 periods but the recession lasts only 6 periods, then the error gets categorized as recessionary, even though it is calculated based on expansionary period errors. This is a limitation that we are aware of and take into account when interpreting the 8 quarters ahead results.   


```{r subs, fig.height=3, fig.cap="Relative Recessionary & Expansionary RMSE"}
joonis  <- relative_rmsfes

joonis  %>%
  kbl(booktabs = T,longtable=T, align="c", digits=2, caption="Relative RMSFEs") %>%
   kable_styling(latex_options = c("striped"), full_width = TRUE) %>%
     column_spec(1:1, width="2in")

```

Figure \@ref(tab:subs) describes subsample relative RMSFE within different forecasting period. If the value is over 1, it indicates that the benchmark model(full sample model) has superior forecasting performance compared to the corresponding subsample model. Over most of the horizons, the results verify our hypothesis and are consistent with the findings of @Siliverstovs2020 - the model with reccessionary subsample has much lower forecasting performance (bigger error) compared to full-sample model, and vice versa for expansionary.


```{r, CSSFED-hist-lm, message = F, warnings = F,echo = F,fig.height=4, fig.cap="Cumulative sum of squared forecast error differential (Linear model vs benchmark historic mean model"}
CSSFED_plot("hist_lm")
```


## Out-of-sample forecasting with Random Forest

```{r, CSSFED-lm-rf, message = F, warnings = F,echo = F, fig.height=4, fig.cap="Cumulative sum of squared forecast error differential (Random forest model vs benchmark linear model"}
CSSFED_plot("lm_rf") 
```

Lastly, we construct a random forest model to see whether the forecasting accuracy can be improved through introducing non-linearity. As it can be seen from the graphs (\@ref(fig:CSSFED-lm-rf)) the overall performance of the random forest model is better when compared to OLS across all of the prediction periods as indicated by the upward sloping graph (meaning that OLS squared errors are larger than the respective squared errors of the random forest model). Furthermore, the same conclusion is derived when looking at the \@ref(fig:RSMFE-lm-vs-rf)) where it can be seen that RF model significantly outperforms during full sample and expansionary periods and mostly outperforms during recessionary periods with the exception of looking 2 quarters ahead where linear model slightly outperforms random forest model. Additionally, the results are consistent with (\@ref(fig:pred-vs-actual-rf)) and (\@ref(fig:squared-errors)). In the latter the comparison between accuracy of random forest and linear model can be clearly seen during H4 and H8 forecasts as linear model's errors spike especially high after the 2008-2009 Financial crisis which is not the case for the random forest model.
On \@ref(fig:var-imp)) we also plot the importance of different variables as extracted from the random forest model. The figure shows on which variables the random forest model relies the most to make predictions i.e. which variables are the most important for the model's accuracy. As it can be seen, throughout different forecast horizons the importance of the variables change - e.g. for H1 predictions the most important variable is baa_aaa (yield spread between BAA and AAA yields) while for H8 the most important variable is TRM1012 (10 year and 1 year treasury yield spread). During H1 and H2 YIV is 2nd and 3rd respectively, however, 6th during H4 and H8. Dummy displays some minor importance during H1 and but none during the other prediction horizons.

```{r, var-imp, message= F, warnings = F,echo = F,  fig.cap="Variable importance"}
p1 <- plot(variable_importance(dep[1]), main="H1")
p2 <- plot(variable_importance(dep[2]), main="H2")
p3 <- plot(variable_importance(dep[3]), main="H4")
p4 <- plot(variable_importance(dep[4]), main="H8")
grid.arrange(p1, p2, p3, p4, nrow=2)

```
